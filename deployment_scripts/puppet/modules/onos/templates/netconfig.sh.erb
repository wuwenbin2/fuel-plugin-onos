#!/bin/bash
# For onos 1.4 and 1.5, after external network is created, you need use cli to give gatewaymac to onos before you allocate floating ip.
# For onos 1.6, this part can be omitted.

set -ux

ping -c 5 <%= @gateway_ip %>
#gatewayMac=`arp -a <%= @gateway_ip -%> | awk '{print $4}'`
gatewayMac=$(arp -a <%= @gateway_ip -%> | grep -Eo "[0-9a-f\]+:[0-9a-f\]+:[0-9a-f\]+:[0-9a-f\]+:[0-9a-f\]+:[0-9a-f\]+")

/opt/onos/bin/onos "externalgateway-update -m $gatewayMac"
